<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.xiaoxi.dao.VisitLogDAO">
    <insert id="insert" parameterType="VisitLog" useGeneratedKeys="true">
      INSERT IGNORE INTO visitlog(short_url, visit_time)
      VALUES (#{shortUrl}, #{visitTime})
    </insert>

    <select id="selectShortUrlCountAndTimeSection" resultType="VisitLog">
        SELECT count(id) AS id, short_url, visit_time FROM visitlog
        WHERE short_url = #{shortUrl}
        AND visit_time >= #{startTime}
        AND visit_time <![CDATA[ <= ]]> #{endTime};
    </select>

    <select id="selectAllUrlCountTimeSection" resultType="VisitLog">
        SELECT * FROM
        ( SELECT COUNT(id) AS id, short_url, visit_time FROM visitlog
          WHERE visit_time >= #{startTime} AND visit_time <![CDATA[ <= ]]> #{endTime}
          GROUP BY short_url
        )
        AS tt ORDER BY tt.visit_time DESC
    </select>
</mapper>